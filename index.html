<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›í™”-ì‚¬í† ì‹œ ë³€í™˜ê¸° (ê¹€í”„ ë°˜ì˜)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 5px;
            font-size: 1em;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* ìœ„ìª½ ì •ë ¬ */
            height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 400px;
            width: 100%;
            margin-top: 10px; /* ì „ì²´ë¥¼ ìœ„ë¡œ ì˜¬ë¦¼ */
        }
        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: -30px; /* ì œëª© ìœ„ ê³µê°„ ë” ì¤„ì´ê¸° */
        }
        .title-container img {
            width: 40px;
            height: auto;
            margin: 0 10px;
        }
        .input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 80%;
            max-width: 300px;
            border: 1px solid #ccc;
            padding: 8px;
            font-size: 1em;
            background: white;
            margin: 0 auto; /* ì¤‘ì•™ ì •ë ¬ */
        }
        .input-container input {
            border: none;
            outline: none;
            text-align: right;
            font-size: 1em;
            width: 100%;
        }
        .input-container span {
            margin-left: 5px;
            font-size: 1em;
            color: gray;
        }
        p {
            font-size: 1.2em;
            font-weight: bold;
        }
        .small-text {
            font-size: 0.7em;
            color: gray;
        }
        .footer {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 0.8em;
            color: gray;
        }
    </style>
    <script>
        let btcPriceGecko = 0;
        let btcPriceUpbit = 0;
        let kimchiPremium = 0;

        async function fetchData() {
            try {
                const timestamp = new Date().getTime();

                // 1. CoinGecko ë¹„íŠ¸ì½”ì¸ ê°€ê²© (KRW) ë° ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                const geckoResponse = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=krw&include_last_updated_at=true&nocache=${timestamp}`);
                const geckoData = await geckoResponse.json();
                btcPriceGecko = geckoData.bitcoin.krw;
                const geckoTime = new Date(geckoData.bitcoin.last_updated_at * 1000).toLocaleString();

                // 2. ì—…ë¹„íŠ¸ ë¹„íŠ¸ì½”ì¸ ê°€ê²© (KRW) ë° ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                const upbitResponse = await fetch(`https://api.upbit.com/v1/ticker?markets=KRW-BTC&nocache=${timestamp}`);
                const upbitData = await upbitResponse.json();
                btcPriceUpbit = upbitData[0].trade_price;
                const upbitTime = new Date(upbitData[0].timestamp).toLocaleString();

                // 3. ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ ê³„ì‚° ((ì—…ë¹„íŠ¸ - ì½”ì¸ê°œì½”) / ì½”ì¸ê°œì½”) * 100
                kimchiPremium = ((btcPriceUpbit - btcPriceGecko) / btcPriceGecko) * 100;

                // ê¹€í”„ ë°˜ì˜ëœ ê°€ê²© ì—…ë°ì´íŠ¸
                document.getElementById('btcPriceGecko').innerText = btcPriceGecko.toLocaleString() + " ì›";
                document.getElementById('btcPriceUpbit').innerText = btcPriceUpbit.toLocaleString() + " ì›";
                document.getElementById('kimchiPremium').innerText = kimchiPremium.toFixed(2) + "%";
                document.getElementById('geckoTime').innerText = "ì—…ë°ì´íŠ¸: " + geckoTime;
                document.getElementById('upbitTime').innerText = "ì—…ë°ì´íŠ¸: " + upbitTime;

            } catch (error) {
                alert("ê°€ê²© ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        }

        function formatInput(input) {
            let value = input.value.replace(/,/g, "");
            if (!isNaN(value) && value !== "") {
                input.value = Number(value).toLocaleString();
            }
        }

        function convert() {
            const inputKRW = document.getElementById('krwInput');
            let rawValue = inputKRW.value.replace(/,/g, "");
            if (btcPriceUpbit === 0) {
                alert("ë¹„íŠ¸ì½”ì¸ ê°€ê²©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                return;
            }

            const satoshi = (rawValue / btcPriceUpbit) * 100000000;

            // ë¯¸ë˜ ê¸°ì¤€: 1 BTC = 165ì–µ ì›ì¼ ë•Œ, 1ì‚¬í† ì‹œ ê°€ê²©
            const futureSatoshiPrice = 16500000000 / 100000000;
            const futureKRW = Math.floor(satoshi * futureSatoshiPrice);

            document.getElementById('satoshiResult').innerText = Number(satoshi.toFixed(0)).toLocaleString() + " Sats";
            document.getElementById('futureKRWResult').innerHTML = "ë¯¸ë˜ 1BTC = 165ì–µ ì›<br>ì¼ ë•Œ ì˜ˆìƒ ì›í™” ê°€ì¹˜:<br>" + futureKRW.toLocaleString() + " ì›";

            // í‚¤ë³´ë“œ ìˆ¨ê¸°ê¸° (ëª¨ë°”ì¼ì—ì„œ ì‘ë™)
            inputKRW.blur();
        }

        window.onload = fetchData;

        // ì—”í„° í‚¤ ì…ë ¥ ì‹œ ìë™ ë³€í™˜
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("krwInput").addEventListener("input", function () {
                formatInput(this);
            });
            document.getElementById("krwInput").addEventListener("keypress", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    convert();
                }
            });
        });
    </script>
</head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JXBKPRECYG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JXBKPRECYG');
</script>
<body>
    <div class="container">
        <div class="title-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/46/Bitcoin.svg" alt="Bitcoin Logo">
            <h1>ì›í™”-ì‚¬í† ì‹œ ë³€í™˜ê¸°</h1>
        </div>
        <p>ğŸ”¹ ì½”ì¸ê°œì½” BTC ê°€ê²©: <span id="btcPriceGecko">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></p>
        <p class="small-text" id="geckoTime">ì—…ë°ì´íŠ¸: ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        <p>ğŸ”¹ ì—…ë¹„íŠ¸ BTC ê°€ê²©: <span id="btcPriceUpbit">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></p>
        <p class="small-text" id="upbitTime">ì—…ë°ì´íŠ¸: ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        <p>ğŸ”¥ ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„: <span id="kimchiPremium">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></p>
        <label for="krwInput">ì›í™” ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
        <div class="input-container">
            <input type="text" id="krwInput" oninput="formatInput(this)" />
            <span>KRW</span>
        </div>
        <button onclick="convert()">ë³€í™˜</button>
        <p id="satoshiResult"></p>
        <p id="futureKRWResult"></p>
    </div>
    <div class="footer">by Soohyun</div>
</body>
</html>
