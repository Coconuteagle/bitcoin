<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›í™”-ì‚¬í† ì‹œ ë³€í™˜ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        let btcPriceGecko = 0;
        let btcPriceUpbit = 0;
        let kimchiPremium = 0;

        async function fetchData() {
            try {
                const timestamp = new Date().getTime();
                const geckoResponse = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=krw&include_last_updated_at=true&nocache=${timestamp}`);
                const geckoData = await geckoResponse.json();
                btcPriceGecko = geckoData.bitcoin.krw;
                const geckoTime = new Date(geckoData.bitcoin.last_updated_at * 1000).toLocaleString();
                
                const upbitResponse = await fetch(`https://api.upbit.com/v1/ticker?markets=KRW-BTC&nocache=${timestamp}`);
                const upbitData = await upbitResponse.json();
                btcPriceUpbit = upbitData[0].trade_price;
                const upbitTime = new Date(upbitData[0].timestamp).toLocaleString();

                kimchiPremium = ((btcPriceUpbit - btcPriceGecko) / btcPriceGecko) * 100;

                document.getElementById('btcPriceGecko').innerHTML = `<span class='text-yellow-400'>${Math.floor(btcPriceGecko).toLocaleString()} ì›</span>`;
                document.getElementById('btcPriceGeckoTime').innerText = "ì—…ë°ì´íŠ¸: " + geckoTime;
                document.getElementById('btcPriceUpbit').innerHTML = `<span class='text-yellow-400'>${Math.floor(btcPriceUpbit).toLocaleString()} ì›</span>`;
                document.getElementById('btcPriceUpbitTime').innerText = "ì—…ë°ì´íŠ¸: " + upbitTime;
                document.getElementById('kimchiPremium').innerText = kimchiPremium.toFixed(2) + "%";
            } catch (error) {
                alert("ê°€ê²© ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        }

        function formatInput(input) {
            let value = input.value.replace(/,/g, "");
            if (!isNaN(value) && value !== "") {
                input.value = Number(value).toLocaleString();
            }
        }

        function convert() {
            const inputKRW = document.getElementById('krwInput');
            let rawValue = inputKRW.value.replace(/,/g, "");
            if (btcPriceUpbit === 0) {
                alert("ë¹„íŠ¸ì½”ì¸ ê°€ê²©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                return;
            }
            const satoshi = (rawValue / btcPriceUpbit) * 100000000;
            document.getElementById('satoshiResult').innerText = Number(satoshi.toFixed(0)).toLocaleString() + " Sats";
            
            const futureBTCPrice = 16500000000;
            const futureSatoshiValue = (satoshi * futureBTCPrice) / 100000000;
            document.getElementById('futureKRWResult').innerHTML = `ë¯¸ë˜ 1BTC = 165ì–µ ì›<br>ì¼ ë•Œ ì˜ˆìƒ ì›í™” ê°€ì¹˜:<br><span class='text-yellow-400'>${Math.floor(futureSatoshiValue).toLocaleString()} ì›</span>`;
        }

        window.onload = function() {
            setTimeout(fetchData, 100);
            document.getElementById('krwInput').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    convert();
                }
            });
        };
    </script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen">
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg w-80 text-center">
        <div class="flex items-center justify-center space-x-2">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/46/Bitcoin.svg" alt="Bitcoin Logo" class="w-10">
            <h1 class="text-2xl font-bold">ì›í™”-ì‚¬í† ì‹œ ë³€í™˜ê¸°</h1>
        </div>
        <p class="mt-4 text-lg">ğŸ”¹ ì½”ì¸ê°œì½” BTC ê°€ê²©:<br><span id="btcPriceGecko">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></p>
        <p class="text-sm text-gray-400" id="btcPriceGeckoTime">ì—…ë°ì´íŠ¸: ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        <p class="mt-2 text-lg">ğŸ”¹ ì—…ë¹„íŠ¸ BTC ê°€ê²©:<br><span id="btcPriceUpbit">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></p>
        <p class="text-sm text-gray-400" id="btcPriceUpbitTime">ì—…ë°ì´íŠ¸: ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        <p class="mt-2 text-lg text-red-400">ğŸ”¥ ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„:<br><span id="kimchiPremium">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></p>
        <label for="krwInput" class="block mt-4 text-sm text-gray-400">ì›í™” ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
        <div class="mt-2 flex items-center bg-gray-700 p-2 rounded-md relative">
            <input type="text" id="krwInput" class="bg-transparent text-right flex-1 outline-none text-lg pr-20" oninput="formatInput(this)" onblur="convert()" onkeypress="if(event.key==='Enter'){convert();}" onfocusout="convert();" onkeydown="if(event.key === 'Tab'){convert();}">>
            <span class="text-gray-400 absolute right-3 whitespace-nowrap bg-gray-700 px-1">KRW</span>
        </div>
        <button onclick="convert()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">ë³€í™˜</button>
        <p id="satoshiResult" class="mt-4 text-xl font-bold"></p>
        <p id="futureKRWResult" class="mt-4 text-lg font-bold text-yellow-400"></p>
    </div>
    <div class="mt-4 text-gray-500 text-sm">by Soohyun</div>
</body>
</html>
